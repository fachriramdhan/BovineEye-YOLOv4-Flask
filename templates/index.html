<!DOCTYPE html>
<html lang="id" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BovineEye AI - Fachri Ramdhan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
      rel="stylesheet"
    />
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#ec4899",
              secondary: "#3b82f6",
            },
          },
        },
      };

      if (
        localStorage.getItem("color-theme") === "dark" ||
        (!("color-theme" in localStorage) &&
          window.matchMedia("(prefers-color-scheme: dark)").matches)
      ) {
        document.documentElement.classList.add("dark");
      } else {
        document.documentElement.classList.remove("dark");
      }
    </script>
    <style>
      /* Mencegah scroll pada body utama */
      body {
        overflow: hidden;
        height: 100vh;
        transition: background-color 0.3s ease, color 0.3s ease;
      }

      /* Kustomisasi scrollbar halus untuk area konten saja */
      .custom-scroll::-webkit-scrollbar {
        width: 4px;
      }
      .custom-scroll::-webkit-scrollbar-track {
        background: transparent;
      }
      .custom-scroll::-webkit-scrollbar-thumb {
        border-radius: 10px;
      }
      .light .custom-scroll::-webkit-scrollbar-thumb {
        background: #e2e8f0;
      }
      .dark .custom-scroll::-webkit-scrollbar-thumb {
        background: #1e293b;
      }

      .light body {
        background-color: #f8fafc;
        color: #0f172a;
      }
      .dark body {
        background-color: #020617;
        color: #f8fafc;
      }

      .panel-card {
        border-radius: 12px;
        border-width: 1px;
        display: flex;
        flex-direction: column;
      }

      .light .panel-card {
        background-color: #ffffff;
        border-color: #e2e8f0;
        shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      }
      .dark .panel-card {
        background-color: #0f172a;
        border-color: #1e293b;
      }

      @keyframes scan-line {
        0% {
          transform: translateY(0);
          opacity: 0;
        }
        50% {
          opacity: 1;
        }
        100% {
          transform: translateY(100%);
          opacity: 0;
        }
      }
      .scan-effect {
        animation: scan-line 3s linear infinite;
        background: linear-gradient(
          to bottom,
          transparent,
          #ec4899,
          transparent
        );
        height: 6px;
      }
    </style>
  </head>
  <body class="p-4 lg:p-6 flex flex-col h-screen antialiased">
    <header
      class="panel-card p-4 flex flex-row items-center justify-between shadow-sm mb-4 shrink-0"
    >
      <div class="flex items-center gap-3">
        <div
          class="w-9 h-9 bg-primary flex items-center justify-center rounded-lg text-white"
        >
          <i class="fas fa-cow"></i>
        </div>
        <div>
          <h1 class="font-bold text-lg tracking-tight uppercase leading-none">
            BovineEye <span class="text-primary italic">AI</span>
          </h1>
          <p
            class="text-[9px] uppercase tracking-widest text-slate-500 font-bold mt-1"
          >
            Diagnostic System v1.0
          </p>
        </div>
      </div>
      <button
        id="theme-toggle"
        class="w-9 h-9 rounded-lg border border-slate-200 dark:border-slate-800 hover:bg-slate-100 dark:hover:bg-slate-800 flex items-center justify-center transition-colors"
      >
        <i
          id="theme-icon"
          class="fas fa-moon text-slate-600 dark:text-amber-400"
        ></i>
      </button>
    </header>

    <main class="grid grid-cols-12 gap-4 flex-grow min-h-0">
      <aside class="col-span-12 lg:col-span-3 flex flex-col gap-4 min-h-0">
        <section class="panel-card p-5 shrink-0">
          <h2
            class="text-[10px] font-bold text-primary uppercase tracking-widest mb-3 border-b border-slate-100 dark:border-slate-800 pb-2"
          >
            Informasi Peneliti
          </h2>

          <div class="space-y-4">
            <div>
              <p
                class="text-[8px] font-bold text-slate-400 uppercase tracking-tight"
              >
                Nama Peneliti
              </p>
              <p
                class="text-xs font-black text-slate-900 dark:text-white uppercase leading-tight"
              >
                Fachri Ramdhan Al Mubaroq
              </p>
            </div>

            <div>
              <p
                class="text-[8px] font-bold text-slate-400 uppercase tracking-tight"
              >
                Program Studi
              </p>
              <p
                class="text-[10px] font-black text-slate-800 dark:text-slate-200 uppercase leading-tight"
              >
                S1 - Teknologi Informasi
              </p>
              <p class="text-[10px] font-bold text-slate-500">
                Universitas Darma Persada (UNSADA)
              </p>
            </div>

            <div class="pt-2 border-t border-slate-100 dark:border-slate-800">
              <p
                class="text-[8px] font-bold text-secondary uppercase tracking-tight mb-1"
              >
                Judul Penelitian
              </p>
              <p
                class="text-[10px] font-bold leading-relaxed text-slate-700 dark:text-slate-300 italic"
              >
                "APLIKASI DETEKSI DINI PENYAKIT MATA PINK-EYE PADA SAPI BERBASIS
                CITRA MENGGUNAKAN MODEL DEEP LEARNING ALGORITMA YOLOv4"
              </p>
            </div>
          </div>
        </section>

        <section
          id="dropzone"
          class="panel-card flex-grow p-6 flex flex-col items-center justify-center border-dashed border-2 cursor-pointer hover:border-primary transition-colors group relative"
        >
          <input type="file" id="fileInput" class="hidden" accept="image/*" />
          <i
            class="fas fa-camera text-3xl mb-3 text-slate-300 group-hover:text-primary"
          ></i>
          <p class="text-xs font-bold uppercase">Unggah Citra</p>
          <p class="text-[9px] text-slate-400 mt-2 text-center">
            Drag & drop atau klik di sini
          </p>
        </section>
      </aside>

      <article
        class="col-span-12 lg:col-span-6 panel-card relative overflow-hidden bg-slate-50 dark:bg-black/20"
      >
        <div class="absolute inset-0 flex items-center justify-center">
          <img
            id="resImage"
            src=""
            class="hidden max-w-full max-h-full object-contain p-4 z-10"
          />

          <div id="placeholderText" class="text-center opacity-20">
            <i class="fas fa-eye text-6xl mb-4"></i>
            <p class="text-[11px] font-bold uppercase tracking-[0.5em]">
              Standby
            </p>
          </div>
        </div>

        <div
          id="scanner"
          class="hidden absolute top-0 left-0 right-0 z-20 scan-effect"
        ></div>

        <div
          id="loading"
          class="hidden absolute inset-0 z-30 flex flex-col items-center justify-center bg-white/90 dark:bg-slate-900/95"
        >
          <div
            class="w-10 h-10 border-4 border-slate-200 dark:border-slate-800 border-t-primary rounded-full animate-spin"
          ></div>
          <p class="text-[10px] font-black uppercase tracking-widest mt-4">
            Analisis Citra...
          </p>
        </div>
      </article>

      <aside
        id="sidePanel"
        class="col-span-12 lg:col-span-3 flex flex-col gap-4 opacity-40 pointer-events-none transition-opacity duration-500 min-h-0"
      >
        <div class="panel-card p-4 shrink-0">
          <h3 class="text-[9px] font-bold text-slate-500 uppercase mb-1">
            Status
          </h3>
          <div id="detStatus" class="text-xl font-black italic tracking-tight">
            â€”
          </div>
        </div>

        <div class="panel-card p-4 shrink-0">
          <div class="flex justify-between items-center mb-2">
            <span class="text-[9px] font-bold text-slate-500 uppercase"
              >Confidence</span
            >
            <span id="detConf" class="text-xs font-mono font-bold">0%</span>
          </div>
          <div
            class="w-full bg-slate-200 dark:bg-slate-800 h-1.5 rounded-full overflow-hidden"
          >
            <div
              id="confBar"
              class="bg-secondary h-full transition-all duration-1000"
              style="width: 0%"
            ></div>
          </div>
        </div>

        <div class="panel-card flex-grow min-h-0">
          <div
            class="p-4 border-b border-slate-100 dark:border-slate-800 shrink-0"
          >
            <h3
              class="text-[9px] font-bold text-slate-500 uppercase tracking-widest"
            >
              Detail Laporan
            </h3>
          </div>
          <div
            id="recList"
            class="p-4 space-y-3 overflow-y-auto custom-scroll flex-grow"
          >
            <p class="text-[10px] italic text-slate-400">Menunggu input...</p>
          </div>
        </div>

        <button
          onclick="window.location.reload()"
          class="w-full py-3 bg-slate-900 dark:bg-white text-white dark:text-slate-900 text-[10px] font-black uppercase tracking-widest rounded-xl hover:opacity-90 shrink-0"
        >
          Reset
        </button>
      </aside>
    </main>

    <script>
      const themeToggleBtn = document.getElementById("theme-toggle");
      const themeIcon = document.getElementById("theme-icon");

      function updateTheme() {
        const isDark = document.documentElement.classList.contains("dark");
        themeIcon.className = isDark
          ? "fas fa-sun text-amber-400"
          : "fas fa-moon text-slate-500";
      }

      themeToggleBtn.addEventListener("click", () => {
        document.documentElement.classList.toggle("dark");
        localStorage.setItem(
          "color-theme",
          document.documentElement.classList.contains("dark") ? "dark" : "light"
        );
        updateTheme();
      });
      updateTheme();

      const fileInput = document.getElementById("fileInput");
      const dropzone = document.getElementById("dropzone");
      dropzone.addEventListener("click", () => fileInput.click());

      fileInput.addEventListener("change", async function () {
        if (this.files && this.files[0]) {
          const formData = new FormData();
          formData.append("image", this.files[0]);
          document.getElementById("loading").classList.remove("hidden");
          document.getElementById("scanner").classList.remove("hidden");
          document.getElementById("placeholderText").classList.add("hidden");

          try {
            const response = await fetch("/detect", {
              method: "POST",
              body: formData,
            });
            const data = await response.json();
            const resImg = document.getElementById("resImage");
            resImg.src = "/" + data.image_url + "?t=" + new Date().getTime();
            resImg.classList.remove("hidden");
            document.getElementById("detStatus").innerText = data.status;
            document.getElementById("detConf").innerText = data.confidence;
            document.getElementById("confBar").style.width = data.confidence;
            const statusText = document.getElementById("detStatus");
            statusText.className = data.status.includes("POSITIF")
              ? "text-xl font-black italic text-primary uppercase"
              : "text-xl font-black italic text-emerald-500 uppercase";
            const recList = document.getElementById("recList");
            recList.innerHTML = `
              <div class="p-3 border border-slate-100 dark:border-slate-800 bg-slate-50/50 dark:bg-slate-800/20 rounded-lg">
                <p class="text-[8px] font-bold text-slate-400 uppercase">Diagnosa</p>
                <p class="text-[11px] font-bold mt-1">${data.stadium}</p>
              </div>
            `;
            data.info_tambahan.forEach((item) => {
              recList.innerHTML += `
                <div class="p-3 border border-slate-100 dark:border-slate-800 bg-white dark:bg-slate-900/30 rounded-lg">
                  <p class="text-[8px] font-bold text-primary uppercase">${item.label}</p>
                  <p class="text-[10px] font-semibold leading-relaxed mt-1 text-slate-600 dark:text-slate-300">${item.text}</p>
                </div>
              `;
            });
            document
              .getElementById("sidePanel")
              .classList.remove("opacity-40", "pointer-events-none");
          } catch (e) {
            console.error(e);
          } finally {
            document.getElementById("loading").classList.add("hidden");
            document.getElementById("scanner").classList.add("hidden");
          }
        }
      });
    </script>
  </body>
</html>
